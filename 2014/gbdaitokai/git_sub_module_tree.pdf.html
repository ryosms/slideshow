<!DOCTYPE html>
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
   <title>git subtreeとかgit submoduleとか</title>
   
   

<style>
html, body { margin: 0; padding: 0; }

body { font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; }

a:link, a:visited { color: black; }

h1 { font-size: 30pt;  }
h2 { font-size: 28pt;  }
h3 { font-size: 25pt;  }
p, li, dt, dd, td, th { font-size: 18pt; }

pre { font-size: 14pt;  }
pre.small { font-size: 11pt; }

pre.code {
        background-color: azure;
        padding: 5px;
      }
     
ul { list-style-type: square; }    
   
.center { text-align: center; }   
     
.slide { page-break-after: always;
         min-height: 100mm;
         padding: 40px;
         
         border: 1px dotted black;

/*      
  background: -moz-linear-gradient( top, maroon, red);
*/
       }



/*
for princexml (CSS3 paged media support)
@page { size: A4 landscape }
*/
</style>

</head>
<body>

<div class="presentation">

<div class='slide '>
<!-- === begin markdown block ===

      generated by markdown 1.1.1 on Ruby 2.1.5 (2014-11-27) [x86_64-darwin13.0]
                on 2014-12-04 23:20:43 +0900 with Markdown engine kramdown (1.5.0)
                  using options {}
  -->

<!-- _S9SLIDE_ -->
<h1 id="section">自己紹介</h1>

<p><img src="./images/bell_tail.png" align="right" /></p>

<p><a href="https://twitter.com/ryosms">@ryosms</a></p>

<ul>
  <li>岡山Gitユーザー会(okagit)</li>
  <li>#パソコン交流会</li>
  <li>#パソコン直流会</li>
  <li>工事のおじさん</li>
</ul>


</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1 id="section-1">内容</h1>

<ul>
  <li>リポジトリ構成</li>
  <li>初期化</li>
  <li>更新の取り込み</li>
  <li>更新の反映</li>
  <li>クローン</li>
  <li>削除</li>
  <li>まとめ</li>
</ul>


</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1 id="section-2">リポジトリ構成</h1>

<ul>
  <li>
    <p>以下の構成で検証しました</p>

    <ul>
      <li>ModuleA</li>
      <li>ModuleB</li>
      <li>Repo4Submodule
        <ul>
          <li>ModuleA : ModuleAをSubmoduleとして取り込み</li>
          <li>ModuleB : ModuleBを〃</li>
        </ul>
      </li>
      <li>Repo4Subtree
        <ul>
          <li>ModuleA : ModuleAをSubtree mergeで取り込み</li>
          <li>ModuleB : ModuleBを〃</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>


</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1 id="git-submodule">初期化 - Git Submodule</h1>

<ul>
  <li>
    <p>以下のコマンドを実行</p>

    <p>$ git submodule add path/to/ModuleA.git ModuleA<br />
  $ git add .<br />
  $ git commit -m “Add ModuleA as submodule”</p>

    <ul>
      <li>Submodule追加後にコミットが必要</li>
    </ul>
  </li>
  <li>
    <p>ModuleBについても同様にして初期化する</p>
  </li>
</ul>


</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1 id="git-submodule-1">初期化 - Git Submodule</h1>

<ul>
  <li>初期化直後のリポジトリ状態
    <ul>
      <li>gitbucketにpushして確認(以下同様)</li>
    </ul>
  </li>
</ul>

<p><img src="./images/Submodule/initialize.png" alt="" /></p>


</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1 id="git-submodule-2">初期化 - Git Submodule</h1>

<ul>
  <li>ちなみにSubmoduleなリポジトリをGitHubで見ると</li>
</ul>

<p><img src="./images/Submodule/github.png" alt="" /></p>

<p>cjag / CJAG-APPS - <a href="https://github.com/cjag/CJAG-APPS">https://github.com/cjag/CJAG-APPS</a></p>


</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1 id="git-submodule-3">初期化 - Git Submodule</h1>

<ul>
  <li>初期化直後のコミットグラフ
    <ul>
      <li>SourceTreeにて確認(以下同様)</li>
    </ul>
  </li>
</ul>

<p><img src="./images/Submodule/commit_graph.png" alt="" /></p>


</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1 id="git-subtree">初期化 - Git Subtree</h1>

<ul>
  <li>
    <p>以下のコマンドを実行</p>

    <p>$ git remote add -f module_a path/to/ModuleA.git<br />
  $ git subtree add –prefix=ModuleA/ –squash module_a master</p>

    <ul>
      <li>subtree addの時点で自動的にコミットされる</li>
    </ul>
  </li>
  <li>
    <p>ModuleBについても同様にして初期化する</p>
  </li>
</ul>


</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1 id="git-subtree-1">初期化 - Git Subtree</h1>

<ul>
  <li>初期化直後のリポジトリ状態</li>
</ul>

<p><img src="./images/Subtree/initialize.png" alt="" /></p>


</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1 id="git-subtree-2">初期化 - Git Subtree</h1>

<ul>
  <li>初期化直後のコミットグラフ</li>
</ul>

<p><img src="./images/Subtree/commit_graph.png" alt="" /></p>


</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1 id="section-3">更新の取り込み - 準備</h1>

<ul>
  <li>
    <p>ModuleAの内容を直接更新</p>

    <p>$ git add.<br />
  $ git commit -m “Update README”<br />
  $ git pull origin master</p>
  </li>
</ul>


</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1 id="git-submodule-4">更新の取り込み - Git Submodule</h1>

<ul>
  <li>
    <p>一度Submoduleのディレクトリに入ってpullする</p>

    <p>$ cd ModuleA<br />
  $ git pull origin master</p>
  </li>
  <li>
    <p>Submoduleから出てcommit</p>

    <p>$ cd ../<br />
  $ git commit -am “Update ModuleA”</p>
  </li>
</ul>


</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1 id="git-submodule-5">更新の取り込み - Git Submodule</h1>

<ul>
  <li>
    <p>もしくは、git submodule foreachを使う</p>

    <p>$ git submodule foreach git pull<br />
  $ git commit -am “Update ModuleA”</p>
  </li>
  <li>
    <p>複数のSubmoduleを一括更新する場合に便利</p>
  </li>
</ul>


</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1 id="git-subtree-3">更新の取り込み - Git Subtree</h1>

<ul>
  <li>
    <p>git subtree pullを使う</p>

    <p>$ git subtree pull –prefix=ModuleA/ –squash module_a master</p>
  </li>
</ul>

 	※ –squashで初期化した場合はpullで–squash付けないとconflictするから注意


</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1 id="git-submodule-6">更新の反映 - Git Submodule</h1>

<ul>
  <li>
    <p>ModuleAを変更後、ModuleAのディレクトリに入ってcommit→pushする</p>

    <p>$ cd ModuleA<br />
  $ git commit -am “Update ModuleA from Repo4Submodule”<br />
  $ git push origin master  </p>
  </li>
  <li>
    <p>Submoduleから出てcommit→push</p>

    <p>$ cd ../<br />
  $ git commit -am “Update Submodule ModuleA”<br />
  $ git push origin master  </p>
  </li>
</ul>


</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1 id="git-subtree-4">更新の反映 - Git Subtree</h1>

<ul>
  <li>
    <p>ModuleBを更新後、普通にcommit→pushする</p>

    <p>$ git commit -am “Update subtree ModuleB”</p>
  </li>
  <li>
    <p>git subtree pushでModuleBのリポジトリにpushする</p>

    <p>$ git subtree push –prefix=ModuleB/ module_b master</p>
  </li>
</ul>


</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1 id="commit-graph---git-submodule">Commit Graph - Git Submodule</h1>

<ul>
  <li>ここまでの操作のCommit Graphを確認</li>
</ul>

<p><img src="./images/Submodule/commit_graph_2.png" alt="" /></p>


</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1 id="commit-graph---git-subtree">Commit Graph - Git Subtree</h1>

<p><img src="./images/Subtree/commit_graph_2.png" alt="" /></p>

<h6 id="submodule">Submoduleに比べたらゴチャゴチャしてる…</h6>


</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1 id="git-submodule-7">クローン - Git Submodule</h1>

<ul>
  <li>
    <p>普通にCloneした後でsubmoduleコマンドで初期化する</p>

    <p>$ git clone path/to/Repo4Submodule.git<br />
  $ git submodule init<br />
  $ git submodule update</p>
  </li>
  <li>
    <p>Clone時にSubmoduleも同時に初期化するには–recursive</p>

    <p>$ git clone –recursive path/to/Repo4Submodule.git</p>
  </li>
</ul>


</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1 id="git-submodule-8">クローン - Git Submodule</h1>

<ul>
  <li>
    <p>Clone直後はSubmoduleのbranchに注意する</p>

    <p>$ cd ModuleA<br />
  $ git branch<br />
  　* (detached from &lt;commit hash&gt;)<br />
  　　master</p>
  </li>
  <li>
    <p>全submoduleのbranchをmasterにするには</p>

    <p>$ git submodule foreach git checkout master</p>

    <p>※ master != push時のsubmodule</p>
  </li>
</ul>


</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1 id="git-subtree-5">クローン - Git Subtree</h1>

<ul>
  <li>
    <p>Clone後にSubtreeのリポジトリを追加する</p>

    <p>$ git clone path/to/Repo4Subtree.git<br />
  $ git remote add -f module_a path/to/ModuleA.git<br />
  $ git remote add -f module_b path/to/ModuleB.git</p>

    <p>※ ModuleA、ModuleBを修正しない(書き戻さない)ならクローンしただけでもOK</p>
  </li>
</ul>


</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1 id="git-submodule-9">削除 - Git Submodule</h1>

<ul>
  <li>
    <p>Submoduleのディレクトリごと削除する場合はgit submodule deinitを使う</p>

    <p><code>shell
  $ git submodule deinit ModuleA  
  $ git rm ModuleA  
  $ git commit -am "Delete submodule, ModuleA"  
  $ rm -rf .git/modules/ModuleA
 </code></p>

    <ul>
      <li>deinitでModuleAディレクトリの中身を(.gitディレクトリごと)空にする</li>
      <li>その後のgit rmで実際にSubmoduleが削除される</li>
      <li>最後に.gitの中に残っているゴミを削除する</li>
    </ul>
  </li>
</ul>


</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1 id="git-submodule-10">削除 - Git Submodule</h1>

<ul>
  <li>Submoduleとしては削除するが、ディレクトリは残したい場合</li>
</ul>


</div>
<div class='slide '>
<!-- _S9SLIDE_ -->
<h1 id="section-4">おしまい</h1>

<p>ご静聴ありがとうございました</p>

<p><img src="./images/last.png" alt="" /></p>
<!-- === end markdown block === -->
</div>


  </div> <!-- presentation -->
</body>
</html> 

